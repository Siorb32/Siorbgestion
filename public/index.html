<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>SGA - GestiÃ³n de Inventario (v8.0 - Persistencia MySQL)</title>
Â  Â  <style>
Â  Â  Â  Â  /* VARIABLES GLOBALES */
Â  Â  Â  Â  :root { 
Â  Â  Â  Â  Â  Â  --primary: #2c3e50; 
Â  Â  Â  Â  Â  Â  --accent: #3498db; 
Â  Â  Â  Â  Â  Â  --danger: #e74c3c; 
Â  Â  Â  Â  Â  Â  --success: #27ae60; 
Â  Â  Â  Â  Â  Â  --purchase: #16a085; /* Compra */
Â  Â  Â  Â  Â  Â  --history: #9b59b6; 
Â  Â  Â  Â  Â  Â  --backup: #f39c12; 
Â  Â  Â  Â  Â  Â  --alert: #ff6347; 
Â  Â  Â  Â  Â  Â  --antiguedad: #8e44ad; /* Stock Inmovilizado */
Â  Â  Â  Â  Â  Â  --logistica: #34495e; /* Nuevo color para LogÃ­stica */
Â  Â  Â  Â  Â  Â  --light: #ecf0f1; 
Â  Â  Â  Â  }
Â  Â  Â  Â  body { 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
Â  Â  Â  Â  Â  Â  background-color: var(--light); 
Â  Â  Â  Â  Â  Â  padding: 20px; 
Â  Â  Â  Â  Â  Â  color: #333; 
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* LAYOUT */
Â  Â  Â  Â  .container { 
Â  Â  Â  Â  Â  Â  max-width: 1200px; 
Â  Â  Â  Â  Â  Â  margin: 0 auto; 
Â  Â  Â  Â  Â  Â  display: grid; 
Â  Â  Â  Â  Â  Â  gap: 20px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .panel { 
Â  Â  Â  Â  Â  Â  background: white; 
Â  Â  Â  Â  Â  Â  padding: 25px; 
Â  Â  Â  Â  Â  Â  border-radius: 8px; 
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* NUEVO ESTILO DE ENCABEZADO PRINCIPAL */
Â  Â  Â  Â  .main-header {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 15px 0 25px;
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  }
Â  Â  Â  Â  .main-header h1 {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  font-size: 2.5em;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .main-header span {
Â  Â  Â  Â  Â  Â  font-size: 1.2em; 
Â  Â  Â  Â  Â  Â  margin-right: 10px;
Â  Â  Â  Â  Â  Â  line-height: 1; 
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }

Â  Â  Â  Â  h2 { 
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--accent); 
Â  Â  Â  Â  Â  Â  padding-bottom: 10px; 
Â  Â  Â  Â  Â  Â  margin-top: 0; 
Â  Â  Â  Â  Â  Â  color: var(--primary); 
Â  Â  Â  Â  }
Â  Â  Â  Â  h3 {
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  color: var(--logistica);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* TARJETAS DE RESUMEN */
Â  Â  Â  Â  .dashboard { 
Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  gap: 20px; 
Â  Â  Â  Â  Â  Â  margin-bottom: 20px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .card { 
Â  Â  Â  Â  Â  Â  background: white; 
Â  Â  Â  Â  Â  Â  padding: 20px; 
Â  Â  Â  Â  Â  Â  flex: 1; 
Â  Â  Â  Â  Â  Â  border-radius: 8px; 
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
Â  Â  Â  Â  Â  Â  text-align: center; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .card h3 { 
Â  Â  Â  Â  Â  Â  margin: 0; 
Â  Â  Â  Â  Â  Â  color: #7f8c8d; 
Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .card p { 
Â  Â  Â  Â  Â  Â  font-size: 2em; 
Â  Â  Â  Â  Â  Â  font-weight: bold; 
Â  Â  Â  Â  Â  Â  margin: 10px 0 0; 
Â  Â  Â  Â  Â  Â  color: var(--primary); 
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* FORMULARIOS Y BOTONES */
Â  Â  Â  Â  .form-grid { 
Â  Â  Â  Â  Â  Â  display: grid; 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
Â  Â  Â  Â  Â  Â  gap: 15px; 
Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  input, select { 
Â  Â  Â  Â  Â  Â  padding: 12px; 
Â  Â  Â  Â  Â  Â  border: 1px solid #bdc3c7; 
Â  Â  Â  Â  Â  Â  border-radius: 5px; 
Â  Â  Â  Â  Â  Â  width: 100%; 
Â  Â  Â  Â  Â  Â  box-sizing: border-box; 
Â  Â  Â  Â  Â  Â  background-color: white; 
Â  Â  Â  Â  }
Â  Â  Â  Â  button, .btn-import { 
Â  Â  Â  Â  Â  Â  border: none; 
Â  Â  Â  Â  Â  Â  padding: 12px 20px; 
Â  Â  Â  Â  Â  Â  border-radius: 5px; 
Â  Â  Â  Â  Â  Â  cursor: pointer; 
Â  Â  Â  Â  Â  Â  font-weight: bold; 
Â  Â  Â  Â  Â  Â  transition: 0.3s; 
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-add { 
Â  Â  Â  Â  Â  Â  background-color: var(--success); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-add:hover { 
Â  Â  Â  Â  Â  Â  background-color: #219150; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-out { 
Â  Â  Â  Â  Â  Â  background-color: var(--danger); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-out:hover { 
Â  Â  Â  Â  Â  Â  background-color: #c0392b; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-buy {
Â  Â  Â  Â  Â  Â  background-color: var(--purchase);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-buy:hover {
Â  Â  Â  Â  Â  Â  background-color: #1abc9c;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-logistica {
Â  Â  Â  Â  Â  Â  background-color: var(--logistica);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-finalizar { 
Â  Â  Â  Â  Â  Â  background-color: #e67e22; 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  Â  Â  margin-top: 15px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .backup-controls { 
Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  gap: 15px; 
Â  Â  Â  Â  Â  Â  margin-top: 15px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-export { 
Â  Â  Â  Â  Â  Â  background-color: var(--backup); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  Â  Â  flex: 1; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-import { 
Â  Â  Â  Â  Â  Â  background-color: var(--primary); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  Â  Â  flex: 1; 
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* TABLAS Y BÃšSQUEDA */
Â  Â  Â  Â  .search-bar { 
Â  Â  Â  Â  Â  Â  margin-bottom: 15px; 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .search-bar input {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  border: 1px solid #bdc3c7;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  table { 
Â  Â  Â  Â  Â  Â  width: 100%; 
Â  Â  Â  Â  Â  Â  border-collapse: collapse; 
Â  Â  Â  Â  }
Â  Â  Â  Â  th, td { 
Â  Â  Â  Â  Â  Â  padding: 10px; 
Â  Â  Â  Â  Â  Â  border: 1px solid #ecf0f1; 
Â  Â  Â  Â  Â  Â  text-align: left; 
Â  Â  Â  Â  }
Â  Â  Â  Â  th { 
Â  Â  Â  Â  Â  Â  background-color: var(--primary); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .logistica-table th {
Â  Â  Â  Â  Â  Â  background-color: var(--logistica);
Â  Â  Â  Â  }
Â  Â  Â  Â  .low-stock {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--danger);
Â  Â  Â  Â  }
Â  Â  Â  Â  .critico-stock { 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--alert); 
Â  Â  Â  Â  Â  Â  background-color: #fcebeb;
Â  Â  Â  Â  }
Â  Â  Â  Â  .alerta-antiguedad { 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--antiguedad); 
Â  Â  Â  Â  Â  Â  background-color: #f6eafb;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* LISTAS TEMPORALES */
Â  Â  Â  Â  .order-list { 
Â  Â  Â  Â  Â  Â  margin-top: 15px; 
Â  Â  Â  Â  Â  Â  border: 1px dashed #ccc; 
Â  Â  Â  Â  Â  Â  padding: 10px; 
Â  Â  Â  Â  Â  Â  border-radius: 5px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .order-item { 
Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  justify-content: space-between; 
Â  Â  Â  Â  Â  Â  padding: 5px 0; 
Â  Â  Â  Â  Â  Â  border-bottom: 1px dotted #eee; 
Â  Â  Â  Â  Â  Â  font-size: 0.9em; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .temp-status { 
Â  Â  Â  Â  Â  Â  padding: 8px; 
Â  Â  Â  Â  Â  Â  background: #ffeaa7; 
Â  Â  Â  Â  Â  Â  border-radius: 4px; 
Â  Â  Â  Â  Â  Â  text-align: center; 
Â  Â  Â  Â  Â  Â  font-weight: bold; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-edit, .btn-delete { 
Â  Â  Â  Â  Â  Â  padding: 5px 10px; 
Â  Â  Â  Â  Â  Â  font-size: 0.8em; 
Â  Â  Â  Â  Â  Â  margin-left: 5px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-edit { 
Â  Â  Â  Â  Â  Â  background-color: var(--accent); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-delete { 
Â  Â  Â  Â  Â  Â  background-color: var(--danger); 
Â  Â  Â  Â  Â  Â  color: white; 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* HISTORIAL */
Â  Â  Â  Â  .log-entry { 
Â  Â  Â  Â  Â  Â  padding: 8px 0; 
Â  Â  Â  Â  Â  Â  border-bottom: 1px dotted #ccc; 
Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  justify-content: space-between; 
Â  Â  Â  Â  Â  Â  font-size: 0.8em; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .log-tipo.INGRESO { color: var(--success); }
Â  Â  Â  Â  .log-tipo.COMPRA { color: var(--purchase); font-weight: bold; }
Â  Â  Â  Â  .log-tipo.SALIDA { color: var(--danger); }
Â  Â  Â  Â  .log-tipo.EDICION { color: var(--history); }
Â  Â  Â  Â  .log-tipo.CREACION { color: var(--success); }
Â  Â  Â  Â  .log-tipo.ELIMINACION { color: #7f8c8d; font-weight: bold; }

Â  Â  Â  Â  /* ESTILOS PARA PESTAÃ‘AS (TABS) */
Â  Â  Â  Â  .tab-container { 
Â  Â  Â  Â  Â  Â  display: flex; 
Â  Â  Â  Â  Â  Â  margin-bottom: 20px; 
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #ccc; 
Â  Â  Â  Â  Â  Â  flex-wrap: wrap; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button {
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #7f8c8d;
Â  Â  Â  Â  Â  Â  transition: 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button:hover { 
Â  Â  Â  Â  Â  Â  color: var(--accent); 
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.active {
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid var(--accent);
Â  Â  Â  Â  Â  Â  margin-bottom: -2px; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.alert-tab.active {
Â  Â  Â  Â  Â  Â  border-bottom-color: var(--alert);
Â  Â  Â  Â  Â  Â  color: var(--alert);
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.antiguedad-tab.active {
Â  Â  Â  Â  Â  Â  border-bottom-color: var(--antiguedad);
Â  Â  Â  Â  Â  Â  color: var(--antiguedad);
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-button.logistica-tab.active {
Â  Â  Â  Â  Â  Â  border-bottom-color: var(--logistica);
Â  Â  Â  Â  Â  Â  color: var(--logistica);
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-content { 
Â  Â  Â  Â  Â  Â  display: none; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .tab-content.active { 
Â  Â  Â  Â  Â  Â  display: block; 
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div class="container">
Â  Â  
Â  Â  <header class="main-header">
Â  Â  Â  Â  <h1>
Â  Â  Â  Â  Â  Â  <span role="img" aria-label="Logo">ğŸ“¦</span> SGA
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <p style="margin-top: 5px; font-size: 0.9em; color: #555;">Sistema de GestiÃ³n AutÃ³noma de Inventario (v8.0 - Persistencia **MySQL**)</p>
Â  Â  </header>
Â  Â  
Â  Â  <div class="panel" style="border-left: 5px solid var(--success); background-color: #eafbe7; padding: 15px; margin-bottom: 20px;">
Â  Â  Â  Â  <h3 style="color: var(--success); margin-top: 0;">âœ… CONEXIÃ“N A BASE DE DATOS (MySQL)</h3>
Â  Â  Â  Â  <p style="margin: 5px 0;">
Â  Â  Â  Â  Â  Â  El sistema ahora guarda **automÃ¡ticamente** todos los cambios en tu Base de Datos remota.
Â  Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <div class="dashboard">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <h3>Total Unidades en Inventario</h3>
Â  Â  Â  Â  Â  Â  <p id="totalUnidades">0</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card" style="border: 2px solid var(--alert);">
Â  Â  Â  Â  Â  Â  <h3>Productos CrÃ­ticos (Stock &lt;= 3)</h3>
Â  Â  Â  Â  Â  Â  <p id="productosCriticos" style="color: var(--alert);">0</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card" style="border: 2px solid var(--antiguedad);">
Â  Â  Â  Â  Â  Â  <h3>Inmovilizado (+15 dÃ­as sin vender)</h3>
Â  Â  Â  Â  Â  Â  <p id="productosAntiguos" style="color: var(--antiguedad);">0</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="tab-container">
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'stockGlobal', 'global')">ğŸ“‹ Stock Global</button>
Â  Â  Â  Â  <button class="tab-button alert-tab" onclick="openTab(event, 'stockGlobal', 'critico')">ğŸš¨ Stock CrÃ­tico (&lt;= 3)</button>
Â  Â  Â  Â  <button class="tab-button antiguedad-tab" onclick="openTab(event, 'stockGlobal', 'antiguedad')">â³ Stock Inmovilizado (+15 dÃ­as)</button>
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'cargaProducto')">â• Nuevo Producto</button>
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'ordenCompra')">ğŸ›’ Ã“rdenes de Compra</button>
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'registroSalidas')">ğŸ“¤ Salidas / Ventas</button>
Â  Â  Â  Â  <button class="tab-button logistica-tab" onclick="openTab(event, 'logistica')">ğŸšš LogÃ­stica (MensajerÃ­a)</button>
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'historial')">ğŸ“œ Historial</button>
Â  Â  Â  Â  <button class="tab-button" onclick="openTab(event, 'respaldo')">ğŸ’¾ Respaldo</button>
Â  Â  </div>

Â  Â  <div id="stockGlobal" class="tab-content panel">
Â  Â  Â  Â  <h2 id="tituloStock">ğŸ“‹ Inventario General</h2>
Â  Â  Â  Â  <div class="search-bar">
Â  Â  Â  Â  Â  Â  <select id="rubroFiltro" onchange="renderizarTablaInventario()" style="width: 200px; flex-shrink: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">TODOS LOS RUBROS</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  <input type="text" id="searchInput" placeholder="Buscar por SKU, Nombre o Rubro..." oninput="renderizarTablaInventario()">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="table-container">
Â  Â  Â  Â  Â  Â  <table id="tablaProductos">
Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>SKU</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Producto</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Rubro</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Stock</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th style="width: 150px;">AntigÃ¼edad (DÃ­as)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <div id="cargaProducto" class="tab-content panel">
Â  Â  Â  Â  <h2>ğŸ“¥ Carga de Producto Nuevo</h2>
Â  Â  Â  Â  <p style="color: #666; font-size: 0.9em;">Utiliza esta secciÃ³n para crear productos que no existen en el sistema. El Stock se inicializarÃ¡ en **cero (0)**.</p>
Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  <input type="text" id="skuInput" placeholder="SKU (CÃ³digo Ãºnico)" style="border-left: 4px solid var(--accent);" required>
Â  Â  Â  Â  Â  Â  <input type="text" id="nombreInput" placeholder="Nombre del Producto" required>
Â  Â  Â  Â  Â  Â  <select id="rubroSelect" onchange="manejarNuevoRubro(this.value)" required></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="btn-add" onclick="agregarProducto()">Crear Producto</button>
Â  Â  </div>

Â  Â  <div id="ordenCompra" class="tab-content panel" style="border-top: 5px solid var(--purchase);">
Â  Â  Â  Â  <h2>ğŸ›’ Cargar Orden de Compra</h2>
Â  Â  Â  Â  <p style="color: #666; font-size: 0.9em;">Reponer stock de productos existentes.</p>
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="form-grid" style="grid-template-columns: 1fr 1fr 1.2fr;">
Â  Â  Â  Â  Â  Â  <input type="date" id="fechaCompra" required>
Â  Â  Â  Â  Â  Â  <input type="text" id="nroOrdenCompra" placeholder="NÃºmero de Orden / Factura" required>
Â  Â  Â  Â  Â  Â  <select id="proveedorSelect" onchange="manejarNuevoProveedor(this.value)" required></select>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <hr style="margin: 20px 0;">
Â  Â  Â  Â  
Â  Â  Â  Â  <h3>Agregar productos a la Orden</h3>
Â  Â  Â  Â  <div class="form-grid" style="grid-template-columns: 2fr 1fr 1fr;">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <input 
Â  Â  Â  Â  Â  Â  Â  Â  type="text" 
Â  Â  Â  Â  Â  Â  Â  Â  id="skuCompra" 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar producto existente..." 
Â  Â  Â  Â  Â  Â  Â  Â  list="listaProductos" 
Â  Â  Â  Â  Â  Â  Â  Â  oninput="buscarParaCompra()" 
Â  Â  Â  Â  Â  Â  Â  Â  onchange="actualizarSKUCompraDesdeDatalist()"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <datalist id="listaProductos"></datalist>

Â  Â  Â  Â  Â  Â  <input type="number" id="cantidadCompra" placeholder="Cantidad a sumar" min="1">
Â  Â  Â  Â  Â  Â  <button class="btn-buy" onclick="agregarItemACompra()">+ Agregar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="nombreCompraDisplay" class="temp-status" style="background-color: #d1f2eb; color: #0e6251;">Pendiente de selecciÃ³n...</div>

Â  Â  Â  Â  <div class="order-list">
Â  Â  Â  Â  Â  Â  <h4>Detalle de la Orden (<span id="totalItemsCompra">0</span>)</h4>
Â  Â  Â  Â  Â  Â  <div id="listaItemsCompra">
Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: #777; padding: 10px;">Lista vacÃ­a.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="btn-finalizar" style="background-color: var(--purchase);" onclick="procesarCompra()">CONFIRMAR Y SUMAR STOCK</button>
Â  Â  Â  Â  <div id="mensajeCompra"></div>
Â  Â  </div>

Â  Â  <div id="registroSalidas" class="tab-content panel" style="border-top: 5px solid var(--danger);">
Â  Â  Â  Â  <h2>ğŸ“¤ Registro de Salidas / Ventas</h2>
Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  <input type="text" id="ordenIdInput" placeholder="ID de la Orden (Ej: VENTA-123)" required>
Â  Â  Â  Â  Â  Â  <input type="text" id="responsableSalida" placeholder="Responsable / Usuario ML" required>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <hr style="margin: 20px 0;">
Â  Â  Â  Â  
Â  Â  Â  Â  <h3>Buscador de Productos</h3>
Â  Â  Â  Â  <div class="form-grid" style="grid-template-columns: 2fr 1fr 1fr;">
Â  Â  Â  Â  Â  Â  <input 
Â  Â  Â  Â  Â  Â  Â  Â  type="text" 
Â  Â  Â  Â  Â  Â  Â  Â  id="skuSalida" 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Buscar por SKU o Nombre..." 
Â  Â  Â  Â  Â  Â  Â  Â  list="listaProductos" 
Â  Â  Â  Â  Â  Â  Â  Â  oninput="buscarParaSalida()" 
Â  Â  Â  Â  Â  Â  Â  Â  onchange="actualizarSKUdesdeDatalist()"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <input type="number" id="cantidadSalida" placeholder="Cantidad a retirar" min="1">
Â  Â  Â  Â  Â  Â  <button class="btn-out" onclick="agregarItemAOrden()">AÃ±adir a Salida</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="nombreSalidaDisplay" class="temp-status">Pendiente de SKU...</div>

Â  Â  Â  Â  <div class="order-list">
Â  Â  Â  Â  Â  Â  <h4>Productos a retirar (<span id="totalItemsOrden">0</span>)</h4>
Â  Â  Â  Â  Â  Â  <div id="listaItemsOrden">
Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: #777;">AÃºn no hay productos en esta salida.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="btn-finalizar" onclick="procesarOrden()">FINALIZAR Y DESCONTAR STOCK</button>
Â  Â  Â  Â  <div id="mensajeSalida"></div>
Â  Â  </div>
Â  Â  
Â  Â  <div id="logistica" class="tab-content panel" style="border-top: 5px solid var(--logistica);">
Â  Â  Â  Â  <h2>ğŸšš LogÃ­stica (MensajerÃ­a por Moto)</h2>
Â  Â  Â  Â  <p style="color: #666; font-size: 0.9em;">Carga los envÃ­os diarios por localidad. El resumen es semanal (**Lunes a SÃ¡bado**) para liquidaciÃ³n.</p>

Â  Â  Â  Â  <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-bottom: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>1. Cargar EnvÃ­os Diarios</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid" style="grid-template-columns: 1fr 1fr 1fr; margin-bottom: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fechaEnvioLogistica" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="partidoLogisticaSelect" onchange="mostrarZonaSeleccionada()"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="cantidadEnviosLogistica" placeholder="NÂ° de EnvÃ­os" min="1" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="zonaDisplayLogistica" style="padding: 5px; background: #ecf0f1; border-radius: 3px; margin-top: 5px; font-size: 0.9em;">Zona: -</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="grid-column: 3 / 4; align-self: end;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-logistica" onclick="agregarMovimientoLogistica()">â• Registrar EnvÃ­os</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>2. Resumen Semanal de LiquidaciÃ³n (Lunes a SÃ¡bado)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <table class="logistica-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Zona</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Total Semana</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="resumenSemanalLogistica">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="2" style="text-align: center; color: #777;">Carga datos para ver el resumen.</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-top: 10px; font-size: 0.8em; color: #666;">*La semana de liquidaciÃ³n incluye Lunes a SÃ¡bado.</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h3>3. Registro de EnvÃ­os por DÃ­a (Semana Actual)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="registroDiarioLogistica" style="max-height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: #777;">Carga datos para ver el detalle diario.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  </div>
Â  Â  
Â  Â  <div id="historial" class="tab-content panel" style="border-top: 5px solid var(--history);">
Â  Â  Â  Â  <h2>ğŸ“œ Historial de Movimientos</h2>
Â  Â  Â  Â  <div class="search-bar" style="display: block;">
Â  Â  Â  Â  Â  Â  <input type="text" id="historialSearchInput" placeholder="Buscar por SKU, Responsable o Nota..." oninput="renderizarHistorial()">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="historialLog"></div>
Â  Â  </div>
Â  Â  
Â  Â  <div id="respaldo" class="tab-content panel" style="border-top: 5px solid var(--backup);">
Â  Â  Â  Â  <h2>ğŸ’¾ Respaldo y ConfiguraciÃ³n</h2>
Â  Â  Â  Â  <p style="font-size: 0.9em; color: #666;">Exporta tus datos como un archivo .json para no perderlos, o impÃ³rtalos al iniciar. **(Esta secciÃ³n ya no es necesaria con MySQL, pero se mantiene por si acaso.)**</p>
Â  Â  Â  Â  <div class="backup-controls">
Â  Â  Â  Â  Â  Â  <button class="btn-export" onclick="exportarDatos()">â¬‡ï¸ Exportar Respaldo (.json)</button>
Â  Â  Â  Â  Â  Â  <label for="fileInput" class="btn-import" style="text-align: center; line-height: 18px;">â¬†ï¸ Importar Respaldo (.json)</label>
Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" accept=".json" onchange="importarDatos(event)" style="display: none;">
Â  Â  Â  Â  </div>
Â  Â  </div>

</div>

<script>
Â  Â  // ------------------------------------------------------------------
Â  Â  // *** MODIFICADO PARA USAR SERVERLESS NODE.JS EN LUGAR DE PHP ***
Â  Â  // ------------------------------------------------------------------
Â  Â  
Â  Â  // Todas las variables se inicializan vacÃ­as. La carga de datos se harÃ¡ por FETCH.
Â  Â  let inventario = []; Â // Llenado por /api/inventario
Â  Â  let movimientos = []; // PENDIENTE: Llenado por get_movimientos.php
Â  Â  let rubrosMaestros = []; // Llenado por get_rubros.php
Â  Â  let proveedoresMaestros = []; // PENDIENTE: Llenado por get_proveedores.php
Â  Â  let logisticaMovimientos = []; // PENDIENTE: Llenado por get_logistica.php
Â  Â  
Â  Â  // OBJETO DE ZONAS MAESTRAS (Se mantiene local)
Â  Â  let zonasMaestras = {
Â  Â  Â  Â  'CAPITAL': ['CABA', 'Capital Federal', 'Microcentro', 'Puerto Madero'],
Â  Â  Â  Â  'PRIMER_CORDON': ['San MartÃ­n', 'Tres de Febrero', 'Vicente LÃ³pez', 'San Isidro', 'Avellaneda', 'LanÃºs', 'Lomas de Zamora', 'Quilmes (Norte)', 'La Matanza (Norte)'],
Â  Â  Â  Â  'SEGUNDO_CORDON': ['Quilmes (Sur)', 'Florencio Varela', 'Berazategui', 'Almirante Brown', 'Esteban EcheverrÃ­a', 'Ezeiza', 'Merlo', 'Moreno', 'Malvinas Argentinas', 'Tigre', 'San Miguel'],
Â  Â  Â  Â  'TERCER_CORDON': ['La Plata', 'CaÃ±uelas', 'LujÃ¡n', 'ZÃ¡rate', 'Pilar', 'General RodrÃ­guez']
Â  Â  };
Â  Â  let partidosMaestros = []; 

Â  Â  let filtroStockCritico = 'global'; 

Â  Â  let ordenTemporal = {
Â  Â  Â  Â  id: '',
Â  Â  Â  Â  responsable: '',
Â  Â  Â  Â  items: [] 
Â  Â  };

Â  Â  let compraTemporal = {
Â  Â  Â  Â  items: []
Â  Â  };

Â  Â  // =======================================================================
Â  Â  // ğŸš€ LÃ“GICA DE CONEXIÃ“N Y CARGA INICIAL (FETCH) ğŸš€
Â  Â  // =======================================================================
Â  Â  
Â  Â  async function cargarDatosIniciales() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // 1. Cargar Inventario usando la NUEVA Serverless Function de Node.js
Â  Â  Â  Â  Â  Â  const invResponse = await fetch('/api/inventario'); // <-- Â¡MODIFICADO!
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!invResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  // Manejar errores HTTP (ej: 404, 500, etc.)
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Error HTTP ${invResponse.status}: La API /api/inventario no respondiÃ³. Revisa logs de Vercel.`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const invData = await invResponse.json();

Â  Â  Â  Â  Â  Â  if (invData.success) {
Â  Â  Â  Â  Â  Â  Â  Â  // Si el backend Node.js devuelve success: true
Â  Â  Â  Â  Â  Â  Â  Â  inventario = invData.data;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Si la consulta SQL fallÃ³ en el backend Node.js
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al cargar inventario (Backend):", invData.message);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`âš ï¸ Error al cargar Inventario desde la BD. Mensaje: ${invData.message}`);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Cargar Rubros (AÃºn usa el endpoint PHP original)
Â  Â  Â  Â  Â  Â  const rubroResponse = await fetch('/api/get_rubros.php');
Â  Â  Â  Â  Â  Â  const rubroData = await rubroResponse.json();
Â  Â  Â  Â  Â  Â  if (rubroData.success) {
Â  Â  Â  Â  Â  Â  Â  Â  rubrosMaestros = rubroData.data;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al cargar rubros:", rubroData.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 3. PENDIENTE: Cargar Movimientos
Â  Â  Â  Â  Â  Â  movimientos = []; // Por ahora vacÃ­o hasta crear el PHP/JS

Â  Â  Â  Â  Â  Â  // 4. Renderizar toda la interfaz con los nuevos datos
Â  Â  Â  Â  Â  Â  cargarRubrosSelect();
Â  Â  Â  Â  Â  Â  cargarProveedoresSelect(); // Se cargarÃ¡ vacÃ­o hasta tener get_proveedores.php
Â  Â  Â  Â  Â  Â  cargarPartidosMaestros(); // Se mantiene local
Â  Â  Â  Â  Â  Â  renderizarTodo(); 

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error('Error fatal de conexiÃ³n al servidor:', error);
Â  Â  Â  Â  Â  Â  alert('âš ï¸ Error de conexiÃ³n con el servidor (Fallo de red o Servidor Down). Revisa la Consola.');
Â  Â  Â  Â  }
Â  Â  }


Â  Â  // --- FUNCIONES DE PERSISTENCIA (Ahora solo llaman a la recarga de la BD) ---

Â  Â  // Las funciones de "guardar" AHORA SOLO LLAMAN A RECARGAR TODO
Â  Â  function guardarInventario() {
Â  Â  Â  Â  // En MySQL, la interfaz se refresca llamando a cargarDatosIniciales() despuÃ©s de un POST.
Â  Â  Â  Â  // AquÃ­ solo se asegura el renderizado si solo se filtrÃ³ localmente.
Â  Â  Â  Â  renderizarTodo(); 
Â  Â  }

Â  Â  function guardarMovimientos() {
Â  Â  Â  Â  // PENDIENTE: Refrescar historial
Â  Â  Â  Â  renderizarHistorial();
Â  Â  }

Â  Â  function guardarRubros() {
Â  Â  Â  Â  // PENDIENTE: El rubro se agrega automÃ¡ticamente en add_producto.php (INSERT IGNORE).
Â  Â  Â  Â  // Recargamos el select con los datos actualizados de la BD.
Â  Â  Â  Â  cargarRubrosSelect();
Â  Â  }

Â  Â  function guardarProveedores() {
Â  Â  Â  Â  cargarProveedoresSelect();
Â  Â  }

Â  Â  function guardarLogistica() {
Â  Â  Â  Â  renderReporteLogistica();
Â  Â  }

Â  Â  // --- FUNCIONES CRUD (MODIFICADAS PARA USAR FETCH) ---

Â  Â  // =======================================================================
Â  Â  // â• CARGA PRODUCTO (FUNCIONANDO CON /api/add_producto.php)
Â  Â  // =======================================================================
Â  Â  async function agregarProducto() {
Â  Â  Â  Â  const sku = document.getElementById('skuInput').value.trim().toUpperCase();
Â  Â  Â  Â  const nombre = document.getElementById('nombreInput').value.trim();
Â  Â  Â  Â  const rubro = document.getElementById('rubroSelect').value;

Â  Â  Â  Â  if (!sku || !nombre || rubro === 'Selecciona Rubro' || rubro === 'NUEVO_RUBRO') {
Â  Â  Â  Â  Â  Â  alert('âš ï¸ Completa SKU, Nombre y selecciona un Rubro vÃ¡lido.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const nuevoProducto = { sku, nombre, rubro };

Â  Â  Â  Â  // NOTA: Esto aÃºn llama al PHP que estÃ¡ en tu repositorio.
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch('/api/add_producto.php', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(nuevoProducto)
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const result = await response.json();

Â  Â  Â  Â  Â  Â  if (response.status === 200 && result.success) {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`âœ… Producto ${sku} agregado a la Base de Datos.`);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Recargar los datos desde la BD para actualizar la tabla y el select de rubros
Â  Â  Â  Â  Â  Â  Â  Â  await cargarDatosIniciales(); 

Â  Â  Â  Â  Â  Â  Â  Â  // Limpiar formulario y navegar
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('skuInput').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nombreInput').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('rubroSelect').value = 'Selecciona Rubro';
Â  Â  Â  Â  Â  Â  Â  Â  openTab(null, 'stockGlobal', 'global');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Maneja el error 409 de SKU duplicado u otros errores del servidor
Â  Â  Â  Â  Â  Â  Â  Â  alert(`â›” Error al agregar producto: ${result.message}`);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error('Error de red/servidor:', error);
Â  Â  Â  Â  Â  Â  alert('âš ï¸ Error de conexiÃ³n con el servidor. No se pudo guardar el producto.');
Â  Â  Â  Â  }
Â  Â  }


Â  Â  // ------------------------------------------------------------------
Â  Â  // *** PENDIENTE DE MODIFICAR ***
Â  Â  // ------------------------------------------------------------------

Â  Â  function procesarCompra() {
Â  Â  Â  Â  // ğŸš¨ PENDIENTE: Esta funciÃ³n requiere el archivo 'procesar_compra.php'
Â  Â  Â  Â  alert('âš ï¸ FUNCIÃ“N PENDIENTE: Necesitas el archivo PHP para procesar la compra y actualizar el stock en la BD.');
Â  Â  }

Â  Â  function procesarOrden() {
Â  Â  Â  Â  // ğŸš¨ PENDIENTE: Esta funciÃ³n requiere el archivo 'procesar_salida.php'
Â  Â  Â  Â  alert('âš ï¸ FUNCIÃ“N PENDIENTE: Necesitas el archivo PHP para procesar la salida y descontar el stock en la BD.');
Â  Â  }
Â  Â  
Â  Â  function agregarMovimientoLogistica() {
Â  Â  Â  Â  // ğŸš¨ PENDIENTE: Esta funciÃ³n requiere el archivo 'add_logistica.php'
Â  Â  Â  Â  alert('âš ï¸ FUNCIÃ“N PENDIENTE: Necesitas el archivo PHP para registrar movimientos de logÃ­stica en la BD.');
Â  Â  }

Â  Â  function eliminarProducto(sku) {
Â  Â  Â  Â  // ğŸš¨ PENDIENTE: Esta funciÃ³n requiere el archivo 'delete_producto.php'
Â  Â  Â  Â  alert('âš ï¸ FUNCIÃ“N PENDIENTE: Necesitas el archivo PHP para eliminar el producto de la BD.');
Â  Â  }


Â  Â  // --- FUNCIONES DE UTILIDAD (SIN CAMBIOS, USAN DATOS LOCALES) ---

Â  Â  function formatFecha(timestamp) {
Â  Â  Â  Â  // ... (Tu cÃ³digo de formatFecha se mantiene) ...
Â  Â  Â  Â  const date = new Date(timestamp);
Â  Â  Â  Â  return date.toLocaleDateString('es-AR', {
Â  Â  Â  Â  Â  Â  year: 'numeric',
Â  Â  Â  Â  Â  Â  month: '2-digit',
Â  Â  Â  Â  Â  Â  day: '2-digit',
Â  Â  Â  Â  Â  Â  hour: '2-digit',
Â  Â  Â  Â  Â  Â  minute: '2-digit'
Â  Â  Â  Â  });
Â  Â  }
Â  Â  
Â  Â  function calcularAntiguedad(fechaUltimaVenta) {
Â  Â  Â  Â  // ... (Tu cÃ³digo de calcularAntiguedad se mantiene) ...
Â  Â  Â  Â  if (!fechaUltimaVenta) return 0; 
Â  Â  Â  Â  const hoy = new Date();
Â  Â  Â  Â  const ultimaVenta = new Date(fechaUltimaVenta);
Â  Â  Â  Â  const diffTime = Math.abs(hoy - ultimaVenta);
Â  Â  Â  Â  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
Â  Â  Â  Â  return diffDays;
Â  Â  }

Â  Â  // --- FUNCIONES DE NAVEGACIÃ“N Y SETUP (MÃNIMOS CAMBIOS) ---

Â  Â  function openTab(evt, tabName, filtro = 'global') {
Â  Â  Â  Â  // ... (Tu cÃ³digo de openTab se mantiene) ...
Â  Â  Â  Â  const contents = document.getElementsByClassName('tab-content');
Â  Â  Â  Â  for (let i = 0; i < contents.length; i++) {
Â  Â  Â  Â  Â  Â  contents[i].classList.remove('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  const buttons = document.getElementsByClassName('tab-button');
Â  Â  Â  Â  for (let i = 0; i < buttons.length; i++) {
Â  Â  Â  Â  Â  Â  buttons[i].classList.remove('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  document.getElementById(tabName).classList.add('active');
Â  Â  Â  Â  
Â  Â  Â  Â  if(evt) {
Â  Â  Â  Â  Â  Â  evt.currentTarget.classList.add('active');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  let btnSelector;
Â  Â  Â  Â  Â  Â  if (filtro === 'critico') {
Â  Â  Â  Â  Â  Â  Â  Â  btnSelector = `.tab-button.alert-tab`;
Â  Â  Â  Â  Â  Â  } else if (filtro === 'antiguedad') {
Â  Â  Â  Â  Â  Â  Â  Â  btnSelector = `.tab-button.antiguedad-tab`;
Â  Â  Â  Â  Â  Â  } else if (tabName === 'logistica') {
Â  Â  Â  Â  Â  Â  Â  Â  btnSelector = `.tab-button.logistica-tab`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  btnSelector = `.tab-button[onclick*='${tabName}'][onclick*='global']`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const btn = document.querySelector(btnSelector);

Â  Â  Â  Â  Â  Â  if (btn) btn.classList.add('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Refrescar contenido especÃ­fico
Â  Â  Â  Â  if (tabName === 'stockGlobal') {
Â  Â  Â  Â  Â  Â  document.getElementById('searchInput').value = ''; 
Â  Â  Â  Â  Â  Â  filtroStockCritico = filtro; 
Â  Â  Â  Â  Â  Â  let titulo = 'ğŸ“‹ Inventario General';
Â  Â  Â  Â  Â  Â  if (filtro === 'critico') {
Â  Â  Â  Â  Â  Â  Â  Â  titulo = 'ğŸš¨ Productos con Stock CrÃ­tico (<= 3 unidades)';
Â  Â  Â  Â  Â  Â  } else if (filtro === 'antiguedad') {
Â  Â  Â  Â  Â  Â  Â  Â  titulo = 'â³ Stock Inmovilizado (+15 dÃ­as sin vender)';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('tituloStock').textContent = titulo;
Â  Â  Â  Â  Â  Â  renderizarTablaInventario();
Â  Â  Â  Â  }
Â  Â  Â  Â  if (tabName === 'historial') {
Â  Â  Â  Â  Â  Â  document.getElementById('historialSearchInput').value = '';
Â  Â  Â  Â  Â  Â  renderizarHistorial();
Â  Â  Â  Â  }
Â  Â  Â  Â  if (tabName === 'ordenCompra') {
Â  Â  Â  Â  Â  Â  Â document.getElementById('fechaCompra').valueAsDate = new Date();
Â  Â  Â  Â  Â  Â  Â cargarProveedoresSelect();
Â  Â  Â  Â  }
Â  Â  Â  Â  if (tabName === 'logistica') {
Â  Â  Â  Â  Â  Â  Â document.getElementById('fechaEnvioLogistica').valueAsDate = new Date();
Â  Â  Â  Â  Â  Â  Â renderReporteLogistica();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function cargarPartidosMaestros() {
Â  Â  Â  Â  // ... (Tu cÃ³digo de cargarPartidosMaestros se mantiene localmente) ...
Â  Â  Â  Â  partidosMaestros = [];
Â  Â  Â  Â  for (const [zona, partidos] of Object.entries(zonasMaestras)) {
Â  Â  Â  Â  Â  Â  partidos.forEach(partido => {
Â  Â  Â  Â  Â  Â  Â  Â  partidosMaestros.push({ nombre: partido, zona: zona });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  partidosMaestros.sort((a, b) => a.nombre.localeCompare(b.nombre));

Â  Â  Â  Â  const select = document.getElementById('partidoLogisticaSelect');
Â  Â  Â  Â  if (!select) return;
Â  Â  Â  Â  select.innerHTML = '<option value="" disabled selected>Selecciona Localidad / Partido</option>';
Â  Â  Â  Â  partidosMaestros.forEach(p => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = p.nombre;
Â  Â  Â  Â  Â  Â  option.textContent = `${p.nombre} (${p.zona.replace('_', ' ')})`;
Â  Â  Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  Â  mostrarZonaSeleccionada(); // Muestra la zona por defecto
Â  Â  }

Â  Â  // --- El resto de tus funciones (renderizarTablaInventario, etc.) se mantienen... ---

Â  Â  // ------------------------------------------------------------------
Â  Â  // *** INICIALIZACIÃ“N ***
Â  Â  // ------------------------------------------------------------------
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  // *** LLAMAMOS A LA CARGA DESDE LA BD ***
Â  Â  Â  Â  cargarDatosIniciales();
Â  Â  Â  Â  
Â  Â  Â  Â  // Abre la pestaÃ±a inicial (Stock Global)
Â  Â  Â  Â  openTab(null, 'stockGlobal', 'global');
Â  Â  });

</script>
</body>
</html>
